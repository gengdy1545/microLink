<?xml version="1.0" encoding="UTF-8"?>
<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" 
             xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" 
             xmlns:activiti="http://activiti.org/bpmn" 
             xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" 
             xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" 
             xmlns:omgdi="http://www.omg.org/spec/DD/20100524/DI" 
             targetNamespace="http://activiti.org/user-system">

    <process id="user-onboarding-process" name="User Onboarding Process" isExecutable="true">
        <startEvent id="startEvent" name="Start" />
        <sequenceFlow id="flow1" sourceRef="startEvent" targetRef="approveTask" />
        
        <userTask id="approveTask" name="Admin Approval" activiti:assignee="admin">
            <documentation>Approve new user registration.</documentation>
        </userTask>
        
        <sequenceFlow id="flow2" sourceRef="approveTask" targetRef="approvalGateway" />
        
        <exclusiveGateway id="approvalGateway" name="Approval Gateway" />
        
        <sequenceFlow id="flowApproved" name="Approved" sourceRef="approvalGateway" targetRef="notificationTask">
            <conditionExpression xsi:type="tFormalExpression">${approved == true}</conditionExpression>
        </sequenceFlow>
        
        <sequenceFlow id="flowRejected" name="Rejected" sourceRef="approvalGateway" targetRef="notificationTask">
            <conditionExpression xsi:type="tFormalExpression">${approved == false}</conditionExpression>
        </sequenceFlow>
        
        <serviceTask id="notificationTask" name="Send Notification" 
                     activiti:delegateExpression="${userNotificationDelegate}" />
        
        <sequenceFlow id="flowEnd" sourceRef="notificationTask" targetRef="endEvent" />
        
        <endEvent id="endEvent" name="End" />
    </process>

    <bpmndi:BPMNDiagram id="BPMNDiagram_user-onboarding">
        <bpmndi:BPMNPlane bpmnElement="user-onboarding-process" id="BPMNPlane_user-onboarding">
            <bpmndi:BPMNShape bpmnElement="startEvent" id="BPMNShape_startEvent">
                <omgdc:Bounds height="35.0" width="35.0" x="50.0" y="180.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="approveTask" id="BPMNShape_approveTask">
                <omgdc:Bounds height="60.0" width="100.0" x="130.0" y="167.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="approvalGateway" id="BPMNShape_approvalGateway" isMarkerVisible="true">
                <omgdc:Bounds height="40.0" width="40.0" x="280.0" y="177.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="notificationTask" id="BPMNShape_notificationTask">
                <omgdc:Bounds height="60.0" width="100.0" x="380.0" y="167.0"/>
            </bpmndi:BPMNShape>
            <bpmndi:BPMNShape bpmnElement="endEvent" id="BPMNShape_endEvent">
                <omgdc:Bounds height="35.0" width="35.0" x="530.0" y="180.0"/>
            </bpmndi:BPMNShape>
            
            <bpmndi:BPMNEdge bpmnElement="flow1" id="BPMNEdge_flow1">
                <omgdi:waypoint x="85.0" y="197.5"/>
                <omgdi:waypoint x="130.0" y="197.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flow2" id="BPMNEdge_flow2">
                <omgdi:waypoint x="230.0" y="197.0"/>
                <omgdi:waypoint x="280.0" y="197.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flowApproved" id="BPMNEdge_flowApproved">
                <omgdi:waypoint x="320.0" y="197.0"/>
                <omgdi:waypoint x="380.0" y="197.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flowRejected" id="BPMNEdge_flowRejected">
                <omgdi:waypoint x="300.0" y="217.0"/>
                <omgdi:waypoint x="300.0" y="240.0"/>
                <omgdi:waypoint x="430.0" y="240.0"/>
                <omgdi:waypoint x="430.0" y="227.0"/>
            </bpmndi:BPMNEdge>
            <bpmndi:BPMNEdge bpmnElement="flowEnd" id="BPMNEdge_flowEnd">
                <omgdi:waypoint x="480.0" y="197.0"/>
                <omgdi:waypoint x="530.0" y="197.5"/>
            </bpmndi:BPMNEdge>
        </bpmndi:BPMNPlane>
    </bpmndi:BPMNDiagram>
</definitions>
